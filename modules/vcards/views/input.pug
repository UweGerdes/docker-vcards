//- input.pug
mixin moreTypes(field, index, used)
  select.select&attributes({ name: 'select_' + field + index, 'data-select-xhr': '/vcards/type/' + field + '/_' + index + '/' })
    option(value='')= '- neu -'
    each type in fields[field].types
      if used.indexOf(type) < 0
        option(value=type)= types[type] || '- ' + type + ' -'

mixin types(field, index, typeList)
  .types
    if typeof typeList == 'string'
      - typeList = [typeList]
    each type, i in typeList
      include input-type.pug
    + moreTypes(field, index, typeList)

mixin input-value(field, value, index, part)
  input(
    type='text',
    id=field + index + (part ? '_' + part : ''),
    name=field + index + (part ? '_' + part : ''),
    class='input-text' + (part ? ' ' + part : ''),
    placeholder=(part ? part : fields[field].label),
    title=(part ? part : fields[field].label),
    size=(fields[field].size ? fields[field].size : ''),
    value=value)

mixin input-group(field, prop, index)
  if fields[field].parts
    each part in fields[field].parts_order
      + input-value(field, prop.value[part], index, part)
  else
    + input-value(field, prop.value, index)
  if prop.type &&  prop.type.length > 0
    + types(field, index, prop.type)
  else if fields[field].types
    .types
      + moreTypes(field, index, [])

if vcard
  - var prop = vcard.prop[field]
  if prop.value
    + input-group(field, prop, '')
  else
    each p, index in prop
      + input-group(field, p, index)
  if fields[field].type == 'list'
    span.add&attributes({ 'data-click-xhr': '/vcards/field/' + field + '/' })= '+'
else
  +input-group(field, { value: '' }, index)

.error(id=field + '-error')
